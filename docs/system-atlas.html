<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>System Atlas — Multi-AI Agentic Workspace v3.0.0</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: system-ui, -apple-system, sans-serif; background: #0f172a; color: #e2e8f0; overflow-x: hidden; }
  .header { background: linear-gradient(135deg, #1e293b, #0f172a); padding: 24px; border-bottom: 1px solid #334155; }
  .header h1 { font-size: 28px; color: #38bdf8; }
  .header p { color: #94a3b8; margin-top: 8px; }
  .header .stats { display: flex; gap: 16px; margin-top: 12px; flex-wrap: wrap; }
  .header .stat { padding: 4px 12px; background: #1e293b; border: 1px solid #334155; border-radius: 6px; font-size: 12px; color: #94a3b8; }
  .header .stat b { color: #38bdf8; }
  .controls { padding: 16px 24px; display: flex; gap: 8px; flex-wrap: wrap; border-bottom: 1px solid #1e293b; }
  .btn { padding: 6px 16px; border: 1px solid #334155; background: #1e293b; color: #94a3b8; border-radius: 6px; cursor: pointer; font-size: 13px; transition: all 0.2s; }
  .btn:hover, .btn.active { background: #0ea5e9; color: white; border-color: #0ea5e9; }
  .canvas { position: relative; width: 100%; min-height: calc(100vh - 200px); overflow: auto; }
  svg { width: 100%; height: 100%; min-height: 1400px; }
  .node { cursor: pointer; transition: transform 0.2s; }
  .node:hover { transform: scale(1.08); }
  .node rect { rx: 8; ry: 8; stroke-width: 2; }
  .node text { font-size: 11px; fill: #e2e8f0; font-weight: 600; }
  .node .subtitle { font-size: 9px; fill: #94a3b8; font-weight: 400; }
  .node .badge-new { font-size: 8px; fill: #4ade80; font-weight: 700; }
  .edge { stroke: #334155; stroke-width: 1.5; fill: none; }
  .edge.active { stroke: #0ea5e9; stroke-width: 2.5; }
  .edge.new { stroke: #4ade80; stroke-width: 2; stroke-dasharray: 6,3; }
  .tooltip { position: fixed; background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 12px 16px; max-width: 360px; z-index: 100; display: none; box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
  .tooltip h3 { color: #38bdf8; font-size: 14px; margin-bottom: 4px; }
  .tooltip p { color: #94a3b8; font-size: 12px; line-height: 1.5; }
  .tooltip .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; margin-top: 6px; }
  .legend { position: fixed; bottom: 16px; right: 16px; background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 12px; }
  .legend-item { display: flex; align-items: center; gap: 8px; margin: 4px 0; font-size: 11px; color: #94a3b8; }
  .legend-dot { width: 12px; height: 12px; border-radius: 3px; }
  @media (max-width: 768px) { .header h1 { font-size: 20px; } .controls { padding: 8px 12px; } .legend { display: none; } .header .stats { gap: 8px; } }
</style>
</head>
<body>

<div class="header">
  <h1>System Atlas</h1>
  <p>Interactive architecture map — Multi-AI Agentic Workspace v3.0.0</p>
  <div class="stats">
    <div class="stat"><b>14</b> Pages</div>
    <div class="stat"><b>17</b> Routers</div>
    <div class="stat"><b>31</b> Services</div>
    <div class="stat"><b>43</b> Models</div>
    <div class="stat"><b>3</b> Providers</div>
    <div class="stat"><b>57</b> KGs</div>
    <div class="stat"><b>100+</b> Endpoints</div>
    <div class="stat"><b>5</b> Themes</div>
  </div>
</div>

<div class="controls">
  <button class="btn active" onclick="showLayer('all')">All Layers</button>
  <button class="btn" onclick="showLayer('frontend')">Frontend</button>
  <button class="btn" onclick="showLayer('backend')">Backend</button>
  <button class="btn" onclick="showLayer('services')">Services</button>
  <button class="btn" onclick="showLayer('external')">External</button>
  <button class="btn" onclick="showLayer('data')">Data Flow</button>
  <button class="btn" onclick="showLayer('new')">New in v3.0</button>
</div>

<div class="canvas">
<svg viewBox="0 0 1400 1400" id="atlas">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#334155" />
    </marker>
    <marker id="arrowhead-active" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0ea5e9" />
    </marker>
    <marker id="arrowhead-new" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4ade80" />
    </marker>
  </defs>

  <!-- Layer labels -->
  <text x="20" y="30" fill="#475569" font-size="12" font-weight="700">FRONTEND (14 pages)</text>
  <text x="20" y="230" fill="#475569" font-size="12" font-weight="700">API LAYER (17 routers)</text>
  <text x="20" y="500" fill="#475569" font-size="12" font-weight="700">SERVICES (31)</text>
  <text x="20" y="780" fill="#475569" font-size="12" font-weight="700">EXTERNAL</text>

  <!-- ============ FRONTEND PAGES (Row 1: 7 pages) ============ -->
  <g class="node" data-layer="frontend" data-tip="ChatPage|Tri-model streaming chat: 43 models from 3 providers (Gemini/Claude/OpenAI), 5 slash commands (/image /tts /video /agent /help), extended thinking, grounding sources, audio player|Route: /chat" onclick="showTip(this, event)">
    <rect x="40" y="50" width="110" height="50" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="95" y="72" text-anchor="middle">ChatPage</text>
    <text x="95" y="86" text-anchor="middle" class="subtitle">/chat</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="CodingPage|IDE with file explorer, code editor, and AI tool use (7 tools)|Route: /coding" onclick="showTip(this, event)">
    <rect x="160" y="50" width="110" height="50" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="215" y="72" text-anchor="middle">CodingPage</text>
    <text x="215" y="86" text-anchor="middle" class="subtitle">/coding</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="AgentsPage|33 NLKE agents dashboard with pipeline builder|Route: /agents" onclick="showTip(this, event)">
    <rect x="280" y="50" width="110" height="50" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="335" y="72" text-anchor="middle">AgentsPage</text>
    <text x="335" y="86" text-anchor="middle" class="subtitle">/agents</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="PlaybooksPage|53 playbooks with search, categories, and reader|Route: /playbooks" onclick="showTip(this, event)">
    <rect x="400" y="50" width="120" height="50" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="460" y="72" text-anchor="middle">PlaybooksPage</text>
    <text x="460" y="86" text-anchor="middle" class="subtitle">/playbooks</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="WorkflowsPage|Visual workflow designer with 4 templates and SSE execution|Route: /workflows" onclick="showTip(this, event)">
    <rect x="530" y="50" width="120" height="50" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="590" y="72" text-anchor="middle">WorkflowsPage</text>
    <text x="590" y="86" text-anchor="middle" class="subtitle">/workflows</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="KGStudioPage|Graph-RAG workspace: 57 KGs, 10 tabs, d3-force + React Flow, hybrid search, edge browser, multi-KG cross-search, NetworkX analytics, RAG chat|Route: /kg-studio" onclick="showTip(this, event)">
    <rect x="660" y="50" width="110" height="50" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="715" y="72" text-anchor="middle">KG Studio</text>
    <text x="715" y="86" text-anchor="middle" class="subtitle">/kg-studio</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="StudioPage|AI-powered React app generator: Chat/Code/Visual modes, Sandpack live preview, 28 components, SQLite persistence, version history, ZIP export|Route: /builder" onclick="showTip(this, event)">
    <rect x="780" y="50" width="110" height="50" fill="#1e3a5f" stroke="#38bdf8" stroke-width="3" />
    <text x="835" y="72" text-anchor="middle">AI Studio</text>
    <text x="835" y="86" text-anchor="middle" class="subtitle">/builder</text>
  </g>

  <!-- Frontend Pages (Row 2: 7 more pages) -->
  <g class="node" data-layer="frontend" data-tip="ExpertsPage|KG-OS Expert Builder: create AI experts backed by knowledge graphs, 4-weight scoring, 56 dimensions, source citations|Route: /experts" onclick="showTip(this, event)">
    <rect x="900" y="50" width="110" height="50" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="955" y="72" text-anchor="middle">ExpertsPage</text>
    <text x="955" y="86" text-anchor="middle" class="subtitle">/experts</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="ToolsPage|58+ Python tools playground: 11 categories, dynamic param forms, output panel|Route: /tools" onclick="showTip(this, event)">
    <rect x="1020" y="50" width="110" height="50" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="1075" y="72" text-anchor="middle">ToolsPage</text>
    <text x="1075" y="86" text-anchor="middle" class="subtitle">/tools</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="VoxPage|VOX voice agent: 34 functions, 16 voices, macros, guided tours, thermal monitoring, auto-reconnect|Route: /vox" onclick="showTip(this, event)">
    <rect x="1140" y="50" width="110" height="50" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="1195" y="72" text-anchor="middle">VoxPage</text>
    <text x="1195" y="86" text-anchor="middle" class="subtitle">/vox</text>
  </g>
  <g class="node" data-layer="frontend new" data-tip="GamesPage|Phaser 3 Game Studio: interview → GDD → generate → preview → refine → expert chat → versions|Route: /games — NEW in v2.5.0" onclick="showTip(this, event)">
    <rect x="1260" y="50" width="110" height="50" fill="#1e3a5f" stroke="#4ade80" stroke-width="3" />
    <text x="1315" y="72" text-anchor="middle">GamesPage</text>
    <text x="1315" y="82" text-anchor="middle" class="badge-new">NEW</text>
    <text x="1315" y="92" text-anchor="middle" class="subtitle">/games</text>
  </g>

  <!-- Row 3: Settings + Integrations + Shared Components -->
  <g class="node" data-layer="frontend" data-tip="SettingsPage|Theme switcher (5 themes), mode toggle, export/import, runtime API key config (Gemini/Claude/OpenAI)|Route: /settings" onclick="showTip(this, event)">
    <rect x="40" y="120" width="120" height="40" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="100" y="144" text-anchor="middle">SettingsPage</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="IntegrationsPage|Platform integrations: Telegram, WhatsApp, Discord, Slack, Gmail, Spotify, Calendar|Route: /integrations" onclick="showTip(this, event)">
    <rect x="170" y="120" width="140" height="40" fill="#1e3a5f" stroke="#3b82f6" />
    <text x="240" y="144" text-anchor="middle">IntegrationsPage</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="BuilderPage|Legacy web app plan + generate (pre-Studio)|Route: /builder-legacy" onclick="showTip(this, event)">
    <rect x="320" y="120" width="120" height="40" fill="#1e3a5f" stroke="#475569" />
    <text x="380" y="144" text-anchor="middle">BuilderPage</text>
  </g>

  <!-- Shared Components -->
  <g class="node" data-layer="frontend" data-tip="AppContext|Global state: projects, models (43), personas, agents, theme, tri-provider|Context API + localStorage" onclick="showTip(this, event)">
    <rect x="500" y="120" width="160" height="40" fill="#1a2744" stroke="#6366f1" />
    <text x="580" y="144" text-anchor="middle">AppContext (State)</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="ModelSelector|Provider filter (Gemini/Claude/OpenAI) + grouped model picker (43 models, 8 categories) + thinking budget + reasoning effort|Used in ChatPanel" onclick="showTip(this, event)">
    <rect x="670" y="120" width="160" height="40" fill="#1a2744" stroke="#6366f1" />
    <text x="750" y="144" text-anchor="middle">ModelSelector</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="useChat Hook|Tri-model SSE streaming, 5 slash commands, tool call handling, processAgentStream for /agent|Core chat logic" onclick="showTip(this, event)">
    <rect x="840" y="120" width="140" height="40" fill="#1a2744" stroke="#6366f1" />
    <text x="910" y="144" text-anchor="middle">useChat Hook</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="Theme System|5 themes: Default, Deluxe-CRT, Scratch, Solarized Zen, Sunset Warm|CSS custom properties (17 vars) + useTheme hook" onclick="showTip(this, event)">
    <rect x="990" y="120" width="140" height="40" fill="#1a2744" stroke="#6366f1" />
    <text x="1060" y="144" text-anchor="middle">Theme System (5)</text>
  </g>
  <g class="node" data-layer="frontend" data-tip="VoxOverlay|Floating VOX pill + transcript overlay, available on all pages|Always visible when VOX active" onclick="showTip(this, event)">
    <rect x="1140" y="120" width="130" height="40" fill="#1a2744" stroke="#6366f1" />
    <text x="1205" y="144" text-anchor="middle">VoxOverlay</text>
  </g>

  <!-- ============ BACKEND ROUTERS (Row 1: 9 routers) ============ -->
  <g class="node" data-layer="backend" data-tip="chat.py|POST /api/chat/stream — SSE streaming via 8-stage agentic loop, memory injection, skill injection, persona composition|Handles Gemini + Claude + OpenAI routing" onclick="showTip(this, event)">
    <rect x="40" y="250" width="120" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="100" y="272" text-anchor="middle">chat.py</text>
    <text x="100" y="286" text-anchor="middle" class="subtitle">/chat/stream</text>
  </g>
  <g class="node" data-layer="backend" data-tip="coding.py|POST /api/coding/stream — 7 tools (files, npm, python), tool execution loop|Server-side tool use" onclick="showTip(this, event)">
    <rect x="170" y="250" width="120" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="230" y="272" text-anchor="middle">coding.py</text>
    <text x="230" y="286" text-anchor="middle" class="subtitle">/coding/stream</text>
  </g>
  <g class="node" data-layer="backend" data-tip="agents.py|GET/POST /api/agents — list, create, run, pipeline, export to Claude Code|Bridge to 33 NLKE agents" onclick="showTip(this, event)">
    <rect x="300" y="250" width="120" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="360" y="272" text-anchor="middle">agents.py</text>
    <text x="360" y="286" text-anchor="middle" class="subtitle">/agents/*</text>
  </g>
  <g class="node" data-layer="backend" data-tip="playbooks.py|GET /api/playbooks — list, search, categories, content|Parses 53 .pb files on startup" onclick="showTip(this, event)">
    <rect x="430" y="250" width="120" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="490" y="272" text-anchor="middle">playbooks.py</text>
    <text x="490" y="286" text-anchor="middle" class="subtitle">/playbooks/*</text>
  </g>
  <g class="node" data-layer="backend" data-tip="workflows.py|GET/POST /api/workflows — templates, saved workflows, AI planning, SSE execution|DAG-based execution" onclick="showTip(this, event)">
    <rect x="560" y="250" width="120" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="620" y="272" text-anchor="middle">workflows.py</text>
    <text x="620" y="286" text-anchor="middle" class="subtitle">/workflows/*</text>
  </g>
  <g class="node" data-layer="backend" data-tip="studio.py|18+ endpoints: SSE streaming, project CRUD, version management, mock server, OpenAPI spec, TypeScript types, ZIP export|AI Studio backend" onclick="showTip(this, event)">
    <rect x="690" y="250" width="120" height="50" fill="#1a3320" stroke="#38bdf8" stroke-width="3" />
    <text x="750" y="272" text-anchor="middle">studio.py</text>
    <text x="750" y="286" text-anchor="middle" class="subtitle">/studio/* (18+)</text>
  </g>
  <g class="node" data-layer="backend" data-tip="experts.py|15 endpoints: Expert CRUD, SSE expert chat (KG-OS retrieval), conversations, KG-OS query/impact/compose/similar, 56 dimensions|KG-OS Expert Builder" onclick="showTip(this, event)">
    <rect x="820" y="250" width="120" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="880" y="272" text-anchor="middle">experts.py</text>
    <text x="880" y="286" text-anchor="middle" class="subtitle">/experts/* (15)</text>
  </g>
  <g class="node" data-layer="backend" data-tip="tools.py|GET/POST /api/tools — list 58+ tools, get definition, execute, stream results|11 tool categories" onclick="showTip(this, event)">
    <rect x="950" y="250" width="120" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="1010" y="272" text-anchor="middle">tools.py</text>
    <text x="1010" y="286" text-anchor="middle" class="subtitle">/tools/*</text>
  </g>
  <g class="node" data-layer="backend" data-tip="vox.py|WebSocket + REST: 34 functions, 16 voices, awareness, tours, macros, thermal, auto-reconnect|VOX voice agent" onclick="showTip(this, event)">
    <rect x="1080" y="250" width="120" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="1140" y="272" text-anchor="middle">vox.py</text>
    <text x="1140" y="286" text-anchor="middle" class="subtitle">/vox, /ws/vox</text>
  </g>

  <!-- Backend Routers Row 2 -->
  <g class="node" data-layer="backend" data-tip="kg.py|33 REST endpoints: databases, nodes, edges, search, analytics, chat, compare, merge, ingest, embeddings|Full KG Studio backend" onclick="showTip(this, event)">
    <rect x="40" y="320" width="160" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="120" y="342" text-anchor="middle">kg.py</text>
    <text x="120" y="356" text-anchor="middle" class="subtitle">/kg/* (33 endpoints)</text>
  </g>
  <g class="node" data-layer="backend" data-tip="media.py|POST /api/media — image generation (Imagen/Nano Banana Pro), video (Veo 3.1), TTS (Gemini), music (Lyria)|4 media generation endpoints" onclick="showTip(this, event)">
    <rect x="210" y="320" width="140" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="280" y="342" text-anchor="middle">media.py</text>
    <text x="280" y="356" text-anchor="middle" class="subtitle">/media/* (4)</text>
  </g>
  <g class="node" data-layer="backend" data-tip="interchange.py|GET/POST /api/mode, /export, /import, /config/keys|Mode toggle + JSON interchange + runtime key config" onclick="showTip(this, event)">
    <rect x="360" y="320" width="140" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="430" y="342" text-anchor="middle">interchange.py</text>
    <text x="430" y="356" text-anchor="middle" class="subtitle">/mode, /export</text>
  </g>
  <g class="node" data-layer="backend new" data-tip="agent.py|POST /api/agent/run (SSE), GET /api/agent/sessions, GET /api/agent/sessions/{id}|Claude Agent SDK — NEW in v2.4.0" onclick="showTip(this, event)">
    <rect x="510" y="320" width="130" height="50" fill="#1a3320" stroke="#4ade80" stroke-width="3" />
    <text x="575" y="342" text-anchor="middle">agent.py</text>
    <text x="575" y="352" text-anchor="middle" class="badge-new">NEW</text>
    <text x="575" y="362" text-anchor="middle" class="subtitle">/agent/* (3)</text>
  </g>
  <g class="node" data-layer="backend new" data-tip="games.py|20+ endpoints: game CRUD, interview, GDD synthesis, code generation (SSE), refine, expert chat, versions, export, patterns, in-game LLM|Games Studio — NEW in v2.5.0" onclick="showTip(this, event)">
    <rect x="650" y="320" width="140" height="50" fill="#1a3320" stroke="#4ade80" stroke-width="3" />
    <text x="720" y="342" text-anchor="middle">games.py</text>
    <text x="720" y="352" text-anchor="middle" class="badge-new">NEW</text>
    <text x="720" y="362" text-anchor="middle" class="subtitle">/games/* (20+)</text>
  </g>
  <g class="node" data-layer="backend new" data-tip="memory.py|6 endpoints: conversations CRUD, messages, search, stats|Persistent conversation memory — NEW in v2.4.0" onclick="showTip(this, event)">
    <rect x="800" y="320" width="130" height="50" fill="#1a3320" stroke="#4ade80" stroke-width="3" />
    <text x="865" y="342" text-anchor="middle">memory.py</text>
    <text x="865" y="352" text-anchor="middle" class="badge-new">NEW</text>
    <text x="865" y="362" text-anchor="middle" class="subtitle">/memory/* (6)</text>
  </g>
  <g class="node" data-layer="backend" data-tip="integrations.py|Webhook endpoints (Telegram, WhatsApp, Discord, Slack, Gmail), management (configure, test, enable, disable), Spotify, Calendar|Platform integrations" onclick="showTip(this, event)">
    <rect x="940" y="320" width="140" height="50" fill="#1a3320" stroke="#22c55e" />
    <text x="1010" y="342" text-anchor="middle">integrations.py</text>
    <text x="1010" y="356" text-anchor="middle" class="subtitle">/integrations/*</text>
  </g>

  <!-- ============ SERVICES ============ -->
  <!-- Row 1: Core AI Services -->
  <g class="node" data-layer="services" data-tip="gemini_service.py|google-genai SDK wrapper: stream_chat, stream_with_tools, generate_content, edit_image, generate_video, TTS, music|Lazy init proxy pattern" onclick="showTip(this, event)">
    <rect x="40" y="520" width="190" height="50" fill="#3b1a1a" stroke="#ef4444" />
    <text x="135" y="542" text-anchor="middle">gemini_service.py</text>
    <text x="135" y="556" text-anchor="middle" class="subtitle">google-genai SDK</text>
  </g>
  <g class="node" data-layer="services" data-tip="claude_service.py|anthropic SDK wrapper: stream_chat, stream_with_tools, stream_with_thinking|Core Claude integration" onclick="showTip(this, event)">
    <rect x="240" y="520" width="190" height="50" fill="#3b2a1a" stroke="#f97316" />
    <text x="335" y="542" text-anchor="middle">claude_service.py</text>
    <text x="335" y="556" text-anchor="middle" class="subtitle">anthropic SDK</text>
  </g>
  <g class="node" data-layer="services new" data-tip="openai_service.py|openai SDK wrapper: Responses API streaming, tool calling, image generation, TTS|NEW in v3.0.0 — OpenAI integration" onclick="showTip(this, event)">
    <rect x="240" y="460" width="190" height="50" fill="#0a2a0a" stroke="#4ade80" stroke-width="3" />
    <text x="335" y="482" text-anchor="middle">openai_service.py</text>
    <text x="335" y="492" text-anchor="middle" class="badge-new">NEW</text>
    <text x="335" y="502" text-anchor="middle" class="subtitle">openai SDK (Responses API)</text>
  </g>
  <g class="node" data-layer="services new" data-tip="agentic_loop.py|8-stage unified pipeline: intake → memory → skills → context → infer → tools → stream → persist|Core orchestration — tri-provider routing (Gemini/Claude/OpenAI)" onclick="showTip(this, event)">
    <rect x="440" y="520" width="190" height="50" fill="#2a1a3b" stroke="#4ade80" stroke-width="3" />
    <text x="535" y="542" text-anchor="middle">agentic_loop.py</text>
    <text x="535" y="556" text-anchor="middle" class="subtitle">8-stage pipeline</text>
  </g>
  <g class="node" data-layer="services" data-tip="model_router.py|Intelligent model selection based on task_type, complexity, budget, context_length|Routes to optimal model" onclick="showTip(this, event)">
    <rect x="640" y="520" width="170" height="50" fill="#2a1a3b" stroke="#a855f7" />
    <text x="725" y="542" text-anchor="middle">model_router.py</text>
    <text x="725" y="556" text-anchor="middle" class="subtitle">Smart routing</text>
  </g>
  <g class="node" data-layer="services" data-tip="agent_bridge.py|Bridge to NLKE agent system: list, run, pipeline, 33 agent catalog|Imports AgentRunner SDK" onclick="showTip(this, event)">
    <rect x="820" y="520" width="160" height="50" fill="#2a1a3b" stroke="#a855f7" />
    <text x="900" y="542" text-anchor="middle">agent_bridge.py</text>
    <text x="900" y="556" text-anchor="middle" class="subtitle">NLKE SDK bridge</text>
  </g>
  <g class="node" data-layer="services" data-tip="playbook_index.py|Parses 53 .pb files, builds search index, keyword matching|In-memory playbook search" onclick="showTip(this, event)">
    <rect x="990" y="520" width="160" height="50" fill="#2a1a3b" stroke="#a855f7" />
    <text x="1070" y="542" text-anchor="middle">playbook_index.py</text>
    <text x="1070" y="556" text-anchor="middle" class="subtitle">53 .pb files</text>
  </g>

  <!-- Row 2: KG Services -->
  <g class="node" data-layer="services" data-tip="kg_service.py|Core KG: 6 schema profiles (unified, standard, claude, hal, from_node, entities), auto-detect, lazy connections, CRUD|Handles 57 SQLite databases" onclick="showTip(this, event)">
    <rect x="40" y="590" width="190" height="50" fill="#1a2a3b" stroke="#06b6d4" />
    <text x="135" y="612" text-anchor="middle">kg_service.py</text>
    <text x="135" y="626" text-anchor="middle" class="subtitle">6 schema profiles</text>
  </g>
  <g class="node" data-layer="services" data-tip="embedding_service.py|Live hybrid search: numpy cosine similarity + BM25/FTS5 + graph boost. Formula: 0.40*emb + 0.45*BM25 + 0.15*graph|Hybrid search — 88.5% recall" onclick="showTip(this, event)">
    <rect x="240" y="590" width="190" height="50" fill="#1a2a3b" stroke="#06b6d4" />
    <text x="335" y="612" text-anchor="middle">embedding_service.py</text>
    <text x="335" y="626" text-anchor="middle" class="subtitle">Hybrid search</text>
  </g>
  <g class="node" data-layer="services" data-tip="analytics_service.py|NetworkX: centrality (degree, betweenness, PageRank), communities (Louvain), shortest path, density|Graph algorithms" onclick="showTip(this, event)">
    <rect x="440" y="590" width="190" height="50" fill="#1a2a3b" stroke="#06b6d4" />
    <text x="535" y="612" text-anchor="middle">analytics_service.py</text>
    <text x="535" y="626" text-anchor="middle" class="subtitle">NetworkX algorithms</text>
  </g>
  <g class="node" data-layer="services" data-tip="ingestion_service.py|AI entity extraction: Gemini structured output, LightRAG pipeline, manual document node|3 ingestion methods" onclick="showTip(this, event)">
    <rect x="640" y="590" width="190" height="50" fill="#1a2a3b" stroke="#06b6d4" />
    <text x="735" y="612" text-anchor="middle">ingestion_service.py</text>
    <text x="735" y="626" text-anchor="middle" class="subtitle">AI entity extraction</text>
  </g>
  <g class="node" data-layer="services" data-tip="rag_chat_service.py|RAG chat: hybrid search top-k, graph expansion 1-2 hops, Gemini streaming, source citations|Knowledge-augmented chat" onclick="showTip(this, event)">
    <rect x="840" y="590" width="190" height="50" fill="#1a2a3b" stroke="#06b6d4" />
    <text x="935" y="612" text-anchor="middle">rag_chat_service.py</text>
    <text x="935" y="626" text-anchor="middle" class="subtitle">RAG + streaming</text>
  </g>

  <!-- Row 3: Expert + VOX + Game Services -->
  <g class="node" data-layer="services" data-tip="expert_service.py|Expert CRUD, conversation management, KG-OS execution pipeline|Expert Builder data layer" onclick="showTip(this, event)">
    <rect x="40" y="660" width="170" height="40" fill="#1a3a2a" stroke="#22c55e" />
    <text x="125" y="684" text-anchor="middle">expert_service.py</text>
  </g>
  <g class="node" data-layer="services" data-tip="kgos_query_engine.py|12 query methods, 14 intents, 56 semantic dimensions, 4-weight scoring formula|KG-OS query engine" onclick="showTip(this, event)">
    <rect x="220" y="660" width="180" height="40" fill="#1a3a2a" stroke="#22c55e" />
    <text x="310" y="684" text-anchor="middle">kgos_query_engine.py</text>
  </g>
  <g class="node" data-layer="services" data-tip="vox_service.py|Gemini Live API + Claude tool_use, 34 function declarations, 16 voices, Google Search grounding|VOX voice sessions" onclick="showTip(this, event)">
    <rect x="410" y="660" width="160" height="40" fill="#1a3a2a" stroke="#22c55e" />
    <text x="490" y="684" text-anchor="middle">vox_service.py</text>
  </g>
  <g class="node" data-layer="services" data-tip="vox_awareness.py + vox_macros.py + vox_thermal.py|Workspace awareness (SQLite), voice macro CRUD + pipe-chaining, Termux thermal monitoring|VOX support services" onclick="showTip(this, event)">
    <rect x="580" y="660" width="180" height="40" fill="#1a3a2a" stroke="#22c55e" />
    <text x="670" y="684" text-anchor="middle">vox_awareness/macros</text>
  </g>
  <g class="node" data-layer="services new" data-tip="game_service.py + game_generator.py + game_llm_service.py|Game project CRUD, Phaser 3 code generation, in-game LLM for NPC dialogue|Games Studio — NEW in v2.5.0" onclick="showTip(this, event)">
    <rect x="770" y="660" width="180" height="40" fill="#1a3a2a" stroke="#4ade80" stroke-width="3" />
    <text x="860" y="680" text-anchor="middle">game_*.py (3)</text>
    <text x="860" y="692" text-anchor="middle" class="badge-new">NEW</text>
  </g>
  <g class="node" data-layer="services new" data-tip="memory_service.py|Persistent conversation KG + FTS5, conversation CRUD, semantic memory search, stats|Memory persistence — NEW in v2.4.0" onclick="showTip(this, event)">
    <rect x="960" y="660" width="170" height="40" fill="#1a3a2a" stroke="#4ade80" stroke-width="3" />
    <text x="1045" y="680" text-anchor="middle">memory_service.py</text>
    <text x="1045" y="692" text-anchor="middle" class="badge-new">NEW</text>
  </g>

  <!-- Row 4: Studio + Support Services -->
  <g class="node" data-layer="services" data-tip="studio_service.py|SQLite CRUD for projects + versions, ZIP export, file persistence|Studio data layer" onclick="showTip(this, event)">
    <rect x="40" y="720" width="160" height="40" fill="#1a3a2a" stroke="#38bdf8" />
    <text x="120" y="744" text-anchor="middle">studio_service.py</text>
  </g>
  <g class="node" data-layer="services" data-tip="openapi_extractor.py|Parse FastAPI code into OpenAPI spec via AST + regex|API contract extraction" onclick="showTip(this, event)">
    <rect x="210" y="720" width="170" height="40" fill="#1a3a2a" stroke="#38bdf8" />
    <text x="295" y="744" text-anchor="middle">openapi_extractor.py</text>
  </g>
  <g class="node" data-layer="services" data-tip="type_generator.py|OpenAPI schemas → TypeScript interfaces (pure Python)|TS type generation" onclick="showTip(this, event)">
    <rect x="390" y="720" width="160" height="40" fill="#1a3a2a" stroke="#38bdf8" />
    <text x="470" y="744" text-anchor="middle">type_generator.py</text>
  </g>
  <g class="node" data-layer="services" data-tip="tools_service.py|58+ tool registry, dynamic import + execution, 11 categories|Tools playground backend" onclick="showTip(this, event)">
    <rect x="560" y="720" width="160" height="40" fill="#1a3a2a" stroke="#a855f7" />
    <text x="640" y="744" text-anchor="middle">tools_service.py</text>
  </g>
  <g class="node" data-layer="services new" data-tip="agent_sdk_service.py|Claude Agent SDK: autonomous agent execution, session management|Agent SDK — NEW in v2.4.0" onclick="showTip(this, event)">
    <rect x="730" y="720" width="170" height="40" fill="#1a3a2a" stroke="#4ade80" stroke-width="3" />
    <text x="815" y="740" text-anchor="middle">agent_sdk_service.py</text>
    <text x="815" y="752" text-anchor="middle" class="badge-new">NEW</text>
  </g>
  <g class="node" data-layer="services new" data-tip="skill_injector.py|10 intent categories, skill injection into chat context|Skill injection — NEW in v2.4.0" onclick="showTip(this, event)">
    <rect x="910" y="720" width="160" height="40" fill="#1a3a2a" stroke="#4ade80" stroke-width="3" />
    <text x="990" y="740" text-anchor="middle">skill_injector.py</text>
    <text x="990" y="752" text-anchor="middle" class="badge-new">NEW</text>
  </g>

  <!-- ============ EXTERNAL ============ -->
  <g class="node" data-layer="external" data-tip="Gemini API|20 Gemini models: Flash, Pro, 3-Pro, Imagen, Veo, TTS, Lyria, Embedding|1M token context, multimodal, 7 categories" onclick="showTip(this, event)">
    <rect x="40" y="800" width="200" height="60" fill="#0c2340" stroke="#0ea5e9" stroke-width="3" />
    <text x="140" y="825" text-anchor="middle" font-size="13">Gemini API (20 models)</text>
    <text x="140" y="845" text-anchor="middle" class="subtitle">Text • Image • Video • Audio • Music</text>
  </g>
  <g class="node" data-layer="external" data-tip="Claude API|3 Claude models: Opus 4.6, Sonnet 4.6, Haiku 4.5|Extended thinking, tool use, Agent SDK" onclick="showTip(this, event)">
    <rect x="260" y="800" width="180" height="60" fill="#3b1800" stroke="#f97316" stroke-width="3" />
    <text x="350" y="825" text-anchor="middle" font-size="13">Claude API (3 models)</text>
    <text x="350" y="845" text-anchor="middle" class="subtitle">Opus • Sonnet • Haiku</text>
  </g>
  <g class="node" data-layer="external new" data-tip="OpenAI API|20 OpenAI models: GPT-5.x, o3/o4 reasoning, GPT Image, Sora, TTS, Whisper, Embeddings, Codex|NEW in v3.0.0 — Responses API streaming" onclick="showTip(this, event)">
    <rect x="260" y="870" width="180" height="60" fill="#0a2a0a" stroke="#4ade80" stroke-width="3" />
    <text x="350" y="895" text-anchor="middle" font-size="13">OpenAI API (20 models)</text>
    <text x="350" y="905" text-anchor="middle" class="badge-new">NEW</text>
    <text x="350" y="915" text-anchor="middle" class="subtitle">Text • Reasoning • Image • Video</text>
  </g>
  <g class="node" data-layer="external" data-tip="57 SQLite KGs|docs/KGS/ — 350MB total, 6 auto-detected schema profiles|Hybrid search: 0.40*emb + 0.45*BM25 + 0.15*graph" onclick="showTip(this, event)">
    <rect x="460" y="800" width="200" height="60" fill="#0c2a2a" stroke="#06b6d4" stroke-width="3" />
    <text x="560" y="825" text-anchor="middle" font-size="13">57 SQLite KGs</text>
    <text x="560" y="845" text-anchor="middle" class="subtitle">350MB • 6 schema profiles</text>
  </g>
  <g class="node" data-layer="external" data-tip="33 NLKE Agents|Python agent fleet: cost-advisor, code-reviewer, workflow-orchestrator...|7 categories, AgentRunner SDK" onclick="showTip(this, event)">
    <rect x="680" y="800" width="180" height="60" fill="#1a0c33" stroke="#a855f7" stroke-width="3" />
    <text x="770" y="825" text-anchor="middle" font-size="13">33 NLKE Agents</text>
    <text x="770" y="845" text-anchor="middle" class="subtitle">Python • 7 Categories</text>
  </g>
  <g class="node" data-layer="external" data-tip="53 Playbooks|Implementation recipes in .pb format|FOUNDATION, DEV, AGENT, KNOWLEDGE, REASONING, SPECIALIZED, ORCHESTRATION" onclick="showTip(this, event)">
    <rect x="880" y="800" width="180" height="60" fill="#1a0c33" stroke="#a855f7" stroke-width="3" />
    <text x="970" y="825" text-anchor="middle" font-size="13">53 Playbooks</text>
    <text x="970" y="845" text-anchor="middle" class="subtitle">.pb files • 7 Categories</text>
  </g>
  <g class="node" data-layer="external new" data-tip="Platform Integrations|Telegram, WhatsApp, Discord, Slack, Gmail, Spotify, Google Calendar|7 platform adapters via messaging gateway" onclick="showTip(this, event)">
    <rect x="1080" y="800" width="180" height="60" fill="#1a1a3b" stroke="#4ade80" stroke-width="3" />
    <text x="1170" y="825" text-anchor="middle" font-size="13">7 Integrations</text>
    <text x="1170" y="840" text-anchor="middle" class="badge-new">NEW</text>
    <text x="1170" y="850" text-anchor="middle" class="subtitle">Telegram • Discord • Slack...</text>
  </g>

  <!-- ============ EDGES ============ -->
  <!-- Frontend → Backend (simplified key connections) -->
  <line class="edge" data-layer="data" x1="95" y1="100" x2="100" y2="250" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="215" y1="100" x2="230" y2="250" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="335" y1="100" x2="360" y2="250" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="460" y1="100" x2="490" y2="250" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="590" y1="100" x2="620" y2="250" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="715" y1="100" x2="120" y2="320" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="835" y1="100" x2="750" y2="250" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="955" y1="100" x2="880" y2="250" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="1075" y1="100" x2="1010" y2="250" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="1195" y1="100" x2="1140" y2="250" marker-end="url(#arrowhead)" />
  <line class="edge new" data-layer="data new" x1="1315" y1="100" x2="720" y2="320" marker-end="url(#arrowhead-new)" />

  <!-- Routers → Core Services -->
  <line class="edge" data-layer="data" x1="100" y1="300" x2="135" y2="520" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="100" y1="300" x2="335" y2="520" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="230" y1="300" x2="135" y2="520" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="360" y1="300" x2="900" y2="520" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="490" y1="300" x2="1070" y2="520" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="620" y1="300" x2="725" y2="520" marker-end="url(#arrowhead)" />

  <!-- Chat → Agentic Loop (new connection) -->
  <line class="edge new" data-layer="data new" x1="100" y1="300" x2="535" y2="520" marker-end="url(#arrowhead-new)" />

  <!-- KG Router → KG Services -->
  <line class="edge active" data-layer="data" x1="120" y1="370" x2="135" y2="590" marker-end="url(#arrowhead-active)" />
  <line class="edge active" data-layer="data" x1="120" y1="370" x2="335" y2="590" marker-end="url(#arrowhead-active)" />
  <line class="edge active" data-layer="data" x1="120" y1="370" x2="535" y2="590" marker-end="url(#arrowhead-active)" />
  <line class="edge active" data-layer="data" x1="120" y1="370" x2="735" y2="590" marker-end="url(#arrowhead-active)" />
  <line class="edge active" data-layer="data" x1="120" y1="370" x2="935" y2="590" marker-end="url(#arrowhead-active)" />

  <!-- Studio Router → Studio Services -->
  <line class="edge active" data-layer="data" x1="750" y1="300" x2="120" y2="720" marker-end="url(#arrowhead-active)" />
  <line class="edge active" data-layer="data" x1="750" y1="300" x2="295" y2="720" marker-end="url(#arrowhead-active)" />
  <line class="edge active" data-layer="data" x1="750" y1="300" x2="470" y2="720" marker-end="url(#arrowhead-active)" />

  <!-- Core Services → External APIs -->
  <line class="edge" data-layer="data" x1="135" y1="570" x2="140" y2="800" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="335" y1="570" x2="350" y2="800" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="900" y1="570" x2="770" y2="800" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="1070" y1="570" x2="970" y2="800" marker-end="url(#arrowhead)" />

  <!-- KG Services → SQLite KGs -->
  <line class="edge active" data-layer="data" x1="135" y1="640" x2="560" y2="800" marker-end="url(#arrowhead-active)" />
  <line class="edge active" data-layer="data" x1="335" y1="640" x2="560" y2="800" marker-end="url(#arrowhead-active)" />
  <line class="edge active" data-layer="data" x1="535" y1="640" x2="560" y2="800" marker-end="url(#arrowhead-active)" />

  <!-- RAG/Ingestion → Gemini API -->
  <line class="edge" data-layer="data" x1="735" y1="640" x2="140" y2="800" marker-end="url(#arrowhead)" />
  <line class="edge" data-layer="data" x1="935" y1="640" x2="140" y2="800" marker-end="url(#arrowhead)" />

  <!-- New: Games → Gemini API -->
  <line class="edge new" data-layer="data new" x1="860" y1="700" x2="140" y2="800" marker-end="url(#arrowhead-new)" />

  <!-- New: Agent SDK → Claude API -->
  <line class="edge new" data-layer="data new" x1="815" y1="760" x2="350" y2="800" marker-end="url(#arrowhead-new)" />

  <!-- New: OpenAI Service → OpenAI API -->
  <line class="edge new" data-layer="data new" x1="335" y1="510" x2="350" y2="870" marker-end="url(#arrowhead-new)" />

  <!-- New: Integrations → Platform -->
  <line class="edge new" data-layer="data new" x1="1010" y1="370" x2="1170" y2="800" marker-end="url(#arrowhead-new)" />
</svg>
</div>

<div class="tooltip" id="tooltip"></div>

<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div> Frontend Pages (14)</div>
  <div class="legend-item"><div class="legend-dot" style="background:#6366f1"></div> Shared Components</div>
  <div class="legend-item"><div class="legend-dot" style="background:#22c55e"></div> API Routers (17)</div>
  <div class="legend-item"><div class="legend-dot" style="background:#ef4444"></div> Gemini Service</div>
  <div class="legend-item"><div class="legend-dot" style="background:#f97316"></div> Claude Service</div>
  <div class="legend-item"><div class="legend-dot" style="background:#a855f7"></div> Support Services</div>
  <div class="legend-item"><div class="legend-dot" style="background:#06b6d4"></div> KG Services (5)</div>
  <div class="legend-item"><div class="legend-dot" style="background:#0ea5e9"></div> External APIs</div>
  <div class="legend-item"><div class="legend-dot" style="background:#38bdf8"></div> Studio (18+ endpoints)</div>
  <div class="legend-item"><div class="legend-dot" style="background:#22c55e"></div> OpenAI Service</div>
  <div class="legend-item"><div class="legend-dot" style="background:#4ade80"></div> New in v3.0.0</div>
  <div class="legend-item"><div class="legend-dot" style="background:#6366f1"></div> Theme System (5)</div>
</div>

<script>
const tooltip = document.getElementById('tooltip');

function showTip(el, event) {
  const data = el.dataset.tip.split('|');
  tooltip.innerHTML = `<h3>${data[0]}</h3><p>${data[1]}</p>${data[2] ? `<div class="badge" style="background:#1e293b;color:#94a3b8">${data[2]}</div>` : ''}`;
  tooltip.style.display = 'block';
  tooltip.style.left = Math.min(event.clientX + 12, window.innerWidth - 380) + 'px';
  tooltip.style.top = Math.min(event.clientY + 12, window.innerHeight - 120) + 'px';
  setTimeout(() => { tooltip.style.display = 'none'; }, 5000);
}

function showLayer(layer) {
  document.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');

  document.querySelectorAll('.node, .edge').forEach(el => {
    const layers = (el.dataset.layer || '').split(' ');
    if (layer === 'all') {
      el.style.opacity = '1';
    } else if (layer === 'new') {
      el.style.opacity = layers.includes('new') ? '1' : '0.15';
    } else {
      el.style.opacity = layers.includes(layer) ? '1' : '0.15';
    }
  });
}

document.addEventListener('click', (e) => {
  if (!e.target.closest('.node')) tooltip.style.display = 'none';
});
</script>
</body>
</html>
